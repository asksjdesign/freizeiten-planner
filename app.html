<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freizeiten Planner</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
  <nav class="container-fluid">
    <ul>
      <li><strong>Freizeiten Planner</strong></li>
    </ul>
    <ul>
      <li><a href="#" class="nav-link active" data-view="planner" data-i18n="planner">Planner</a></li>
      <li><a href="#" class="nav-link" data-view="people" data-i18n="children">Children</a></li>
      <li><a href="#" class="nav-link" data-view="selections" data-i18n="savedPlans">Saved Plans</a></li>
      <li>
        <div class="lang-switcher">
          <button class="lang-btn" data-lang="en" onclick="I18n.setLang('en'); refreshDynamicContent();">EN</button>
          <button class="lang-btn" data-lang="de" onclick="I18n.setLang('de'); refreshDynamicContent();">DE</button>
        </div>
      </li>
      <li><span id="user-name"></span></li>
      <li><a href="#" onclick="Auth.logout()" data-i18n="logout">Logout</a></li>
    </ul>
  </nav>

  <main class="container">
    <!-- Planner View -->
    <section id="view-planner" class="view">
      <div class="planner-layout">
        <div class="calendar-container">
          <div class="calendar-header">
            <h3 id="calendar-title"></h3>
            <div class="calendar-header-right">
              <div class="calendar-nav" id="calendar-nav">
                <button class="nav-arrow" onclick="Calendar.prev()" aria-label="Previous month">‹</button>
                <button class="nav-arrow" onclick="Calendar.next()" aria-label="Next month">›</button>
              </div>
              <div class="view-toggle">
                <button class="view-toggle-btn active" data-view="calendar" onclick="Calendar.showView('calendar')" aria-label="Calendar view"><ion-icon name="calendar-outline"></ion-icon></button>
                <button class="view-toggle-btn" data-view="list" onclick="Calendar.showView('list')" aria-label="List view"><ion-icon name="list-outline"></ion-icon></button>
              </div>
            </div>
          </div>
          <div id="calendar"></div>
          <div id="camps-list" class="camps-list" style="display: none;"></div>
        </div>
        <aside class="planner-sidebar">
          <div class="sidebar-section">
            <div class="section-header">
              <h3 data-i18n="selectChildren">Select Children</h3>
              <select id="planner-people-sort" class="mini-select" onchange="Planner.setSortOrder(this.value)">
                <option value="oldest" data-i18n="oldestFirst">Oldest first</option>
                <option value="youngest" data-i18n="youngestFirst">Youngest first</option>
              </select>
            </div>
            <div id="people-checkboxes" class="people-list">
              <p class="empty-state" data-i18n="addChildrenFirst">Add children in the Children tab first</p>
            </div>
          </div>

          <div class="sidebar-section cost-summary">
            <div class="section-header">
              <h3 data-i18n="selectedCamps">Selected Camps</h3>
              <button class="expand-btn" onclick="Planner.showExpandedView()" title="Expand">⤢</button>
            </div>
            <div id="cost-breakdown">
              <p class="empty-state" data-i18n="clickToSelect">Click on camps in the calendar to select them</p>
            </div>
            <div class="total-cost">
              <strong><span data-i18n="total">Total</span>: <span id="total-cost">0.00</span> EUR</strong>
            </div>
          </div>

          <div class="sidebar-actions">
            <button onclick="Planner.saveSelection()" class="primary" data-i18n="savePlan">Save Plan</button>
            <button onclick="Planner.clearSelection()" class="secondary outline" data-i18n="clear">Clear</button>
          </div>
        </aside>
      </div>

      <!-- Camp Detail Modal -->
      <dialog id="camp-modal">
        <article>
          <header>
            <button aria-label="Close" rel="prev" onclick="closeCampModal()"></button>
            <h3 id="modal-camp-name"></h3>
          </header>
          <div id="modal-camp-details"></div>
          <footer>
            <div id="modal-camp-selection"></div>
          </footer>
        </article>
      </dialog>

      <!-- Expanded Selection Modal -->
      <dialog id="expanded-modal" class="expanded-modal">
        <article>
          <header>
            <button aria-label="Close" rel="prev" onclick="closeExpandedModal()"></button>
            <h3 data-i18n="selectedCamps">Selected Camps</h3>
          </header>
          <div id="expanded-content"></div>
          <footer>
            <div class="expanded-total">
              <strong><span data-i18n="total">Total</span>: <span id="expanded-total-cost">0.00</span> EUR</strong>
            </div>
          </footer>
        </article>
      </dialog>
    </section>

    <!-- People View -->
    <section id="view-people" class="view" style="display: none;">
      <header class="view-header">
        <h2 data-i18n="manageChildren">Manage Children</h2>
        <div class="view-header-actions">
          <select id="people-sort" onchange="App.sortPeople(this.value)">
            <option value="oldest" data-i18n="oldestFirst">Oldest first</option>
            <option value="youngest" data-i18n="youngestFirst">Youngest first</option>
          </select>
          <button onclick="showAddPersonModal()" data-i18n="addChild">Add Child</button>
        </div>
      </header>

      <div id="people-list" class="people-cards">
        <p class="empty-state" data-i18n="noChildren">No children added yet. Click "Add Child" to get started.</p>
      </div>

      <!-- Add/Edit Person Modal -->
      <dialog id="person-modal">
        <article>
          <header>
            <button aria-label="Close" rel="prev" onclick="closePersonModal()"></button>
            <h3 id="person-modal-title" data-i18n="addChild">Add Child</h3>
          </header>
          <form id="person-form" onsubmit="handlePersonSubmit(event)">
            <input type="hidden" id="person-id">
            <label>
              <span data-i18n="name">Name</span>
              <input type="text" id="person-name" required data-i18n-placeholder="childName">
            </label>
            <label>
              <span>Birthdate</span>
              <input type="date" id="person-birthdate" required>
            </label>
            <footer>
              <button type="button" class="secondary" onclick="closePersonModal()" data-i18n="cancel">Cancel</button>
              <button type="submit" data-i18n="save">Save</button>
            </footer>
          </form>
        </article>
      </dialog>
    </section>

    <!-- Selections View -->
    <section id="view-selections" class="view" style="display: none;">
      <header class="view-header">
        <h2 data-i18n="savedPlansTitle">Saved Plans</h2>
      </header>

      <div id="selections-list" class="selections-cards">
        <p class="empty-state" data-i18n="noSavedPlans">No saved plans yet. Create a plan in the Planner tab.</p>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script src="js/api.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/calendar.js"></script>
  <script src="js/planner.js"></script>
  <script src="js/app.js"></script>
  <script>
    function refreshDynamicContent() {
      // Refresh people checkboxes
      if (Planner.people.length > 0) {
        Planner.renderPeopleCheckboxes();
      }
      // Refresh cost breakdown
      Planner.updateUI();
      // Refresh people cards
      App.renderPeopleCards(Planner.people);
      // Refresh selections
      App.loadSelectionsView();
      // Update sort dropdown options
      const sortSelect = document.getElementById('people-sort');
      if (sortSelect) {
        sortSelect.options[0].text = I18n.t('oldestFirst');
        sortSelect.options[1].text = I18n.t('youngestFirst');
      }
      const plannerSortSelect = document.getElementById('planner-people-sort');
      if (plannerSortSelect) {
        plannerSortSelect.options[0].text = I18n.t('oldestFirst');
        plannerSortSelect.options[1].text = I18n.t('youngestFirst');
      }
    }
  </script>
</body>
</html>
